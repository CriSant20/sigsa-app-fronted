<div class="sidebar">
  <img src="logo.png" alt="Logo" class="logo" />
  <ul class="menu">
    <li><a (click)="mostrarSolicitudes()">Mis Solicitudes</a></li>
    <li><a (click)="mostrarPerfil()">Perfil</a></li>
    <li><a (click)="cerrarSesion()">Cerrar Sesión</a></li>
  </ul>
</div>

<div class="main-content">
  <header>
    <h1>Gestión Cliente</h1>
    <div class="user-info">
      {{ usuario.nombre }} {{ usuario.apellido }}
    </div>
  </header>

  <section *ngIf="!perfilVisible">
    <div class="filters">
      <button (click)="abrirModalAgregarTarea()">Agregar Tarea</button>
      <input type="text" placeholder="Buscar tarea..." [(ngModel)]="searchQuery" />
      <select [(ngModel)]="filterState">
        <option value="">Todos los estados</option>
        <option value="en revision">En Revisión</option>
        <option value="aprobado">Aprobado</option>
        <option value="cancelado">Cancelado</option>
      </select>
      <input type="date" [(ngModel)]="startDate" />
      <input type="date" [(ngModel)]="endDate" />
      <button (click)="borrarFiltros()">Borrar Filtros</button>
    </div>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Tarea</th>
            <th>Fecha Entrega</th>
            <th>Estado</th>
            <th>Acciones</th>
            <th>Encuesta</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let tarea of filteredTareas">
            <td>{{ tarea.nombre }}</td>
            <td>{{ formatFecha(tarea.fechaEntrega) }}</td>
            <td>{{ tarea.estado }}</td>
            <td>
              <div class="actions">
                <button *ngIf="tarea.estado === 'en revision'" class="cancelar" (click)="cancelarTarea(tarea, $event)">Cancelar Tarea</button>
                <button *ngIf="tarea.estado === 'aprobado'" class="pago" (click)="pagar(tarea, $event)">Pago</button>
                <button class="comentario" (click)="abrirChat(tarea, $event)">Comentario</button>
                <button class="informacion" (click)="mostrarInformacion(tarea, $event)">Información</button>
              </div>
            </td>
            <td>
              <button class="survey-button" (click)="abrirEncuesta()">Encuesta</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  <section *ngIf="perfilVisible" class="perfil-interfaz">
    <button class="close" (click)="cerrarPerfil()">X</button>
    <h2>Perfil</h2>
    <img [src]="usuario.foto" alt="Foto de Perfil" class="logo" />
    <div class="perfil-datos">
      <div class="perfil-item">
        <label><strong>Nombre:</strong></label>
        <input [(ngModel)]="usuario.nombre" [readonly]="!editando" />
      </div>
      <div class="perfil-item">
        <label><strong>Apellido:</strong></label>
        <input [(ngModel)]="usuario.apellido" [readonly]="!editando" />
      </div>
      <div class="perfil-item">
        <label><strong>Celular:</strong></label>
        <input [(ngModel)]="usuario.celular" [readonly]="!editando" />
      </div>
      <div class="perfil-item">
        <label><strong>Correo:</strong></label>
        <input [(ngModel)]="usuario.correo" [readonly]="!editando" />
      </div>
      <div class="perfil-item">
        <label><strong>Institución:</strong></label>
        <input [(ngModel)]="usuario.institucion" [readonly]="!editando" />
      </div>
      <div class="perfil-item">
        <label><strong>Carrera:</strong></label>
        <input [(ngModel)]="usuario.carrera" [readonly]="!editando" />
      </div>
    </div>
    <div class="buttons">
      <button *ngIf="!editando" (click)="editarPerfil()">Editar</button>
      <button *ngIf="editando" (click)="guardarPerfil()">Guardar</button>
    </div>
  </section>

  <footer>
    <p>SIGSA - ModoCliente</p>
  </footer>

  <!-- Modal de Información -->
  <div class="modal" *ngIf="informacionVisible">
    <div class="modal-content">
      <button class="close" (click)="cerrarModalInformacion()">X</button>
      <h2>Información de la Tarea</h2>
      <div class="tarea-datos">
        <div><strong>Nombre:</strong> {{ tareaSeleccionada.nombre }}</div>
        <div><strong>Fecha Entrega:</strong> {{ formatFecha(tareaSeleccionada.fechaEntrega) }}</div>
        <div><strong>Estado:</strong> {{ tareaSeleccionada.estado }}</div>
      </div>
    </div>
  </div>

  <!-- Modal de Comentarios -->
  <div class="modal" *ngIf="comentarioVisible">
    <div class="modal-content">
      <button class="close" (click)="cerrarModalComentario()">X</button>
      <h2>Comentarios</h2>
      <textarea [(ngModel)]="comentarios" rows="5" cols="50"></textarea>
      <button (click)="guardarComentario()">Guardar</button>
    </div>
  </div>

  <!-- Modal de Encuesta -->
  <div class="modal" *ngIf="encuestaVisible">
    <div class="modal-content">
      <button class="close" (click)="cerrarEncuesta()">X</button>
      <h2>Encuesta de Satisfacción</h2>
      <form (ngSubmit)="enviarEncuesta()">
        <div>
          <label>¿Cómo calificaría la atención recibida?</label>
          <select [(ngModel)]="encuesta.atencion" name="atencion">
            <option value="excelente">Excelente</option>
            <option value="buena">Buena</option>
            <option value="regular">Regular</option>
            <option value="mala">Mala</option>
          </select>
        </div>
        <div>
          <label>¿Cómo calificaría la resolución de su tarea?</label>
          <select [(ngModel)]="encuesta.resolucion" name="resolucion">
            <option value="excelente">Excelente</option>
            <option value="buena">Buena</option>
            <option value="regular">Regular</option>
            <option value="mala">Mala</option>
          </select>
        </div>
        <div>
          <label>Comentarios adicionales:</label>
          <textarea [(ngModel)]="encuesta.comentarios" name="comentarios"></textarea>
        </div>
        <button type="submit">Enviar</button>
      </form>
    </div>
  </div>

  <!-- Modal de Agregar Tarea -->
  <div class="modal" *ngIf="agregarTareaVisible">
    <div class="modal-content agregar-tarea">
      <button class="close" (click)="cerrarModalAgregarTarea()">X</button>
      <h2>Agregar Tarea</h2>
      <form (ngSubmit)="guardarTarea()">
        <div>
          <label>Tarea:</label>
          <input type="text" [(ngModel)]="nuevaTarea.nombre" name="nombre" required />
        </div>
        <div>
          <label>Tipo:</label>
          <select [(ngModel)]="nuevaTarea.tipo" name="tipo" required>
            <option value="tarea">Tarea</option>
            <option value="articulo">Artículo</option>
            <option value="ejercicios">Ejercicios</option>
            <option value="informe">Informe</option>
            <option value="infografia">Infografía</option>
            <option value="presentacion">Presentación</option>
          </select>
        </div>
        <div>
          <label>Indicaciones/Detalle:</label>
          <textarea [(ngModel)]="nuevaTarea.detalle" name="detalle" required></textarea>
        </div>
        <div>
          <label>Rúbrica:</label>
          <textarea [(ngModel)]="nuevaTarea.rubrica" name="rubrica" required></textarea>
        </div>
        <div>
          <label>Adjunto:</label>
          <div class="file-info">{{ nuevaTarea.adjunto?.name || '' }}</div>
          <label class="file-label" for="adjunto">Seleccionar archivo</label>
          <input type="file" id="adjunto" (change)="onFileSelected($event)" />
        </div>
        <div class="buttons">
          <button type="button" class="cancel" (click)="cerrarModalAgregarTarea()">Cancelar</button>
