<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gesti贸n Sigsa Software</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>

  <body>
    <div class="layout-wrapper">
      <app-navbar></app-navbar>
      <app-menu></app-menu>

      <main class="main-content">
        <section *ngIf="!perfilVisible" class="filter-section">
          <div class="filters">
            <input type="text" placeholder="Buscar tarea..." [(ngModel)]="searchQuery" />
            <select [(ngModel)]="filterState">
              <option value="">Todos los estados</option>
              <option value="En Revisi贸n">En Revisi贸n</option>
              <option value="Aprobada">Aprobada</option>
              <option value="En Progreso">En Progreso</option>
              <option value="Finalizado">Finalizado</option>
              <option value="Rechazada">Rechazada</option>
              <option value="Cancelada">Cancelada</option>
            </select>
            <input type="date" [(ngModel)]="fechaInicio" />
            <input type="date" [(ngModel)]="fechaFin" />
            <button (click)="borrarFiltros()">Borrar Filtros</button>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Tarea</th>
                  <th>Fecha Envio</th>
                  <th>Fecha de Entrega</th>
                  <th>Estado</th>
                  <th>Costo</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let tarea of filteredTareas">
                  <td>{{ tarea.id }}</td>
                  <td>{{ tarea.nombre }}</td>
                  <td>{{ tarea.fecha_envio | date:'yyyy-MM-dd' }}</td>
                  <td>{{ tarea.fecha_a_realizar }}</td>
                  <td>
                    <select
                    [(ngModel)]="tarea.estado" 
                    (change)="actualizarEstado(tarea.id ?? 0, tarea.estado || '')">
                    <option [value]="TaskState.EN_REVISION">{{ TaskState.EN_REVISION }}</option>
                    <option [value]="TaskState.APROBADA">{{ TaskState.APROBADA }}</option>
                    <option [value]="TaskState.EN_PROGRESO">{{ TaskState.EN_PROGRESO }}</option>
                    <option [value]="TaskState.FINALIZADO">{{ TaskState.FINALIZADO }}</option>
                    <option [value]="TaskState.RECHAZADA">{{ TaskState.RECHAZADA }}</option>
                    <option [value]="TaskState.CANCELADA">{{ TaskState.CANCELADA }}</option>
                    </select>
                  </td>
                  
                  
                  <td>{{ tarea.costo || '-' }}</td>
                  <td>
                    <div class="actions">
                      <button class="comentario" (click)="abrirChat(tarea, $event)">Comentario</button>
                      <button class="informacion" (click)="mostrarInformacion(tarea, $event)">Informaci贸n</button>
                      <button class="Comprobante" (click)="mostrarInformacion(tarea, $event)">Comprobante</button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>
        <footer>
          <app-footer></app-footer>
        </footer>
      </main>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
